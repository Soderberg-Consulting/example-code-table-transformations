!function(t,e){"use strict";function a(t){var e=["January","February","March","April","May","June","July","August","September","October","November","December"],a=new Date(t),i=a.getHours()>=12?"PM":"AM",o=(a.getMinutes()<10?"0":"")+a.getMinutes(),s=a.getHours();s>12?s-=12:0===s&&(s=12);var n=" "+s+":"+o+" "+i;return e[a.getMonth()]+" "+a.getDate()+", "+a.getFullYear()+n}function i(t){for(var e in t)t[e]["#text"]&&(t[e]=t[e]["#text"]);return t}function o(t){var e={};if(3==t.nodeType&&(e=t.nodeValue),t.hasChildNodes())for(var a=0;a<t.childNodes.length;a++){var i=t.childNodes.item(a),s=i.nodeName;if("undefined"==typeof e[s])e[s]=o(i);else{if("undefined"==typeof e[s].push){var n=e[s];e[s]=[],e[s].push(n)}e[s].push(o(i))}}return e}var s=function(e,a){this.el=t(e),this.$notification=null,this.$widget=null,this.orgPadding=null,this.severity=null,this.defaults={archivedPath:"/ou-alerts/archived-alerts.xml",activePath:"/ou-alerts/active-alerts.xml",icon:!1,title:!0,subtitle:!0,description:!0,link:!0,date:!0,dateFormat:"",delay:!1,closeOnClick:!0,popup:!0,showClass:"fadeInDown",hideClass:"zoomOut",animationType:"animated-fast",emergency:{class:"oualerts-notify-error",position:"modal",icon:"fa fa-exclamation-triangle",iconColor:"#F44336",fontColor:"",backgroundColor:"",template:!1},warning:{class:"oualerts-notify-warning",position:"top",icon:"fa fa-exclamation-circle",iconColor:"#f08a24",fontColor:"",backgroundColor:"",template:!1},announcement:{class:"oualerts-notify-info",position:"top",icon:"fa fa-bullhorn",iconColor:"#6091ba",fontColor:"",backgroundColor:"",template:!1},widgetTemplate:!1,archiveHeader:!0},t.extend(!0,this.defaults,a),this.init()};s.prototype.init=function(){var t=this;this.loading(),"active"===this.defaults.type?this.fetch("active").then(function(e){e&&(t.defaults.popup===!0?t.notify(e.alert,t.defaults):(t.loading(!0),t.widget(e,t.defaults)))}):this.fetch("archived").then(function(e){t.loading(!0),t.widget(e,t.defaults,!0)})},s.prototype.fetch=function(e){var a=this,i=t.Deferred(),s="active"===e?this.defaults.activePath:this.defaults.archivedPath;return t.ajax({type:"GET",url:s,dataType:"xml",success:function(t){"active"===e?i.resolve(a.prepareData(o(t))):i.resolve(a.prepareArchivedData(o(t)))},error:function(t){i.reject(t)}}),i},s.prototype.widget=function(t,e,a){"function"==typeof e.widgetTemplate?this.$widget=e.widgetTemplate(t,e):a?this.$widget=n(t,e):this.$widget=d(t,e),this.el.html(this.$widget)},s.prototype.notify=function(e,a){var i=this;this.severity=e["ou:severity"].toLowerCase(),"function"==typeof i.defaults[i.severity].template?this.$notification=i.defaults[i.severity].template(e,a):this.$notification=this.createNotificationTemplate(e,a),a.closeOnClick&&t("body").click(function(){i.remove()}),a.delay?setTimeout(function(){i.el.append(i.$notification),"top"===i.defaults[i.severity].position&&i.applyPadding()},a.delay):(this.el.append(this.$notification),"top"===i.defaults[i.severity].position&&i.applyPadding())},s.prototype.calcPadding=function(t){var e=this.$notification,a=t+e.height()+"px";this.el.css("padding-top",a)},s.prototype.applyPadding=function(){this.orgPadding=parseInt(this.el.css("padding-top")),this.calcPadding(this.orgPadding),t(e).resize(this.calcPadding(this.orgPadding))},s.prototype.remove=function(){var t=this;"top"===this.defaults[this.severity.toLowerCase()].position&&this.el.css("padding-top",this.orgPadding),this.$notification.removeClass(this.defaults.showClass).addClass(this.defaults.hideClass),this.$notification.on("oanimationend animationend webkitAnimationEnd",function(){t.$notification.remove()})},s.prototype.prepareArchivedData=function(t){var e=[];if(!t.rss.channel.item.length)return!1;t.rss.channel.item.forEach(function(a){"alert"===a["dc:type"]["#text"]&&(a.updates=[],t.rss.channel.item.forEach(function(t){"update"===t["dc:type"]["#text"]&&t["dc:identifier"]["#text"]===a["dc:identifier"]["#text"]&&a.updates.push(i(t))}),e.push(i(a)))});var a={archive:e,channel:{description:t.rss.channel.description["#text"],language:t.rss.channel.language["#text"],lastBuildDate:t.rss.channel.lastBuildDate["#text"],link:t.rss.channel.link["#text"],title:t.rss.channel.title["#text"]}};return a},s.prototype.prepareData=function(t){var e,a=[];if(!t.rss.channel.item.length)return!1;t.rss.channel.item.forEach(function(t){"alert"===t["dc:type"]["#text"]?e=i(t):"update"===t["dc:type"]["#text"]&&a.push(i(t))}),a.sort(function(t,e){return new Date(e.pubDate)-new Date(t.pubDate)});var o={alert:e,updates:a,channel:{description:t.rss.channel.description["#text"],language:t.rss.channel.language["#text"],lastBuildDate:t.rss.channel.lastBuildDate["#text"],link:t.rss.channel.link["#text"],title:t.rss.channel.title["#text"]}};return o},s.prototype.loading=function(t){this.defaults.popup||t?t&&(this.el.addClass("ready"),this.el.removeClass("loading")):this.el.addClass("loading")};var n=function(e,a){var i=t('<div class="oualerts-archive-wrapper"></div>'),o=t("<h2>Archived Alerts</h2>"),s=t('<ul class="oualerts-archive-list"></ul>');return e.archive.forEach(function(e){var i=r(e,a),o=t('<li class="oualerts-archive"></li>'),n=t('<ul class="oualerts-update-cont"/>');if(o.append(i),e.updates&&e.updates.length){var d=t('<h4 class="oualerts-archive-update-header">Updates: </h4>');o.append(d),o.append(n),e.updates.forEach(function(e){var i=l(e,a,!0),o=t('<li class="oualerts-archive-update"></li>');o.append(i),n.append(o)}),o.append(n)}s.append(o)}),a.archiveHeader&&i.append(o),i.append(s),i},r=function(e,i){var o=t("<div></div>"),s=t("<div>"+a(e.pubDate)+"</div>"),n=t('<h2 class="oualerts-title">'+e.title+"</h2>"),r=t("<div>"+e.description+"</div>");if(i.icon){var l=t('<i class="'+i[e["ou:severity"].toLowerCase()].icon+'"></i>'),d=i[e["ou:severity"].toLowerCase()].iconColor;d&&l.css({color:d}),n.prepend(l)}return o.append(s).append(n),e["ou:subtitle"]&&o.append('<h3 class="oualerts-subtitle">'+e["ou:subtitle"]+"</h3>"),o.append(r),o},l=function(t,e,i){var o='<div class="'+(i?"":"oualerts-active-update")+'"><div class="'+(i?"":"oualerts-active-update-title")+'">'+t.title+' <span class="pull-right">'+a(t.pubDate)+"</span></div><div>"+t.description+"</div></div>";return o},d=function(e,a){var i=r(e.alert,a),o=t("<h4>Updates:</h4>"),s=t('<ul class="oualerts-active-update-list"/>');return e.updates.forEach(function(t){s.append(l(t,a))}),i.append(o).append(s),i};s.prototype.createNotificationTemplate=function(e,i){var o,s=this,n=t("<div></div>",{class:"oualerts-notify "+i[e["ou:severity"].toLowerCase()].class+" "+i.animationType+" "+i.showClass});if(o=t('<div class="oualerts-notify-body"/>'),i.date){var r=a(e.pubDate),l=t('<div class="oualerts-notify-date">'+r+"</div>");o.append(l)}if(i.title){var d=t('<div class="oualerts-notify-title">'+e.title+"</div>");if(i.icon){var c=t('<i class="'+i[e["ou:severity"].toLowerCase()].icon+'"></i>'),u=i[e["ou:severity"].toLowerCase()].iconColor;u&&c.css({color:u}),d.prepend(c)}o.append(d)}if(i.subtitle&&e["ou:subtitle"]){var p=t('<div class="oualerts-notify-subtitle">'+e["ou:subtitle"]+"</div>");o.append(p)}if(i.description){var h=t('<div class="oualerts-notify-msg">'+e.description+"</div>");if(i.link&&e.guid&&e.guid.indexOf(".xml")<0){var f=t('<a href="'+e.guid+'" target="_blank" class="oualerts-notify-link"> Read More...</a>');h.append(f)}o.append(h)}n.append(o),t('<span class="oualerts-close">&times;</span>').click(function(){s.remove()}).appendTo(n),"bottom"===i[e["ou:severity"].toLowerCase()].position?n.addClass("oualerts-bottom"):"top"===i[e["ou:severity"].toLowerCase()].position?n.addClass("oualerts-top"):"modal"===i[e["ou:severity"].toLowerCase()].position&&(n.addClass("oualerts-modal"),n=t('<div class="oualerts-notify-modal-overlay"/>').append(n));var v=i[e["ou:severity"].toLowerCase()].backgroundColor;v&&n.css({backgroundColor:v});var g=i[e["ou:severity"].toLowerCase()].fontColor;return g&&n.css({color:g}),n},t.fn.OUAlert=function(){var t=this,e=arguments[0],a=t.length,i=0;for(i;i<a;i++)t[i].OUAlert=new s(t[i],e);return t},e.OUAlerts=s}(jQuery,window);